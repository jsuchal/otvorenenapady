<div class="container">

  <div id="timeline">
    <%
      lines, points, anchors = timelineize(@events)
    %>
    <div class="line main" style="height: 8000px; left: 0;">
      <% points.each do |point| %>
          <%
             events, start, cardinality = point
             klass = cardinality > 1 ? :more : "category#{events.first.category}"
          %>
          <div class="point <%= klass %>" style="top: <%= start %>px;" data-event="<%= events.collect(&:id).join(',') %>">
            <div><% if cardinality > 1 %><%= cardinality %><% else %>&nbsp;<% end %></div>
          </div>
      <% end %>
    </div>
    <% lines.each do |line| %>
        <%
           event, depth, start, length = line
        %>
        <div class="line category<%= event.category %>" style="height: <%= length %>px; top: <%= start %>px; left: -<%= depth*18+7 %>px;" data-event="<%= event.id %>">
          <div></div>
        </div>
    <% end %>
    <% anchors.each do |anchor| %>
        <%
           event, start = anchor
        %>
        <div class="anchor" style="top: <%= start %>px"><%= event.strftime("%b'%y") %></div>
    <% end %>
  </div>

  <div class="row">
    <div class="span5">&nbsp;</div>
    <div id="events" class="span11">
      <div class="event new">
        <h2><a href="javascript:void(0)" data-toggle-id="new_message">Napísať novú správu</a></h2>

        <div class="content" id="new_message" style="display: none;">
          <div class="comments">
            <div class="comment">
              <div class="user"><%= gravatar_for('johno@jsmf.net', 40) %></div>
              <div class="content">
                    <div class="input"><%= text_field_tag :title, nil, class: :xlarge %></div>
                <%= text_area_tag :comment %>
                <br>

                <div class="input"><%= submit_tag 'Odoslať', class: 'btn primary' %></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <% @events.each do |event| %>
        <%= render "events/#{event.category.downcase}", :event => event %>
      <% end %>
    </div>
  </div>
</div>
